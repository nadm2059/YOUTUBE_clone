<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube Flask Clone</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <header>
    <div class="logo">ðŸŽ¬ YouTube</div>
    <input id="searchInput" type="text" placeholder="Search YouTube videos" />
    <button id="searchBtn">Search</button>
  </header>

  <main>
    <section id="videoGrid"></section>
    <div id="playerContainer"></div>
  </main>

  <script>
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const grid = document.getElementById('videoGrid');
    const player = document.getElementById('playerContainer');

    async function searchVideos(query) {
      const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
      const data = await response.json();
      return data.items || [];
    }

    function createVideoCard(video) {
      const card = document.createElement('div');
      card.className = 'video-card';

      card.innerHTML = `
        <img class="thumbnail" src="${video.snippet.thumbnails.medium.url}" alt="${video.snippet.title}" />
        <div class="video-info">
          <img class="channel-avatar" src="${video.channelAvatar}" alt="${video.snippet.channelTitle}" />
          <div class="text-info">
            <p class="video-title">${video.snippet.title}</p>
            <p class="video-channel">${video.snippet.channelTitle}</p>
            <p class="video-stats">${parseInt(video.statistics.viewCount).toLocaleString()} views</p>
          </div>
        </div>
      `;

      card.addEventListener('click', () => {
        player.innerHTML = `
          <iframe width="900" height="506"
            src="https://www.youtube.com/embed/${video.id}?autoplay=1&rel=0"
            allow="autoplay; encrypted-media" allowfullscreen>
          </iframe>
        `;
        window.scrollTo({ top: player.offsetTop - 20, behavior: 'smooth' });
      });

      return card;
    }

    async function render(query) {
      grid.innerHTML = '<p>Loading videos...</p>';
      const videos = await searchVideos(query);

      if (videos.length === 0) {
        grid.innerHTML = '<p>No videos found.</p>';
        player.innerHTML = '';
        return;
      }

      grid.innerHTML = '';
      player.innerHTML = '';

      videos.forEach(video => {
        grid.appendChild(createVideoCard(video));
      });
    }

    searchBtn.addEventListener('click', () => {
      if (searchInput.value.trim()) {
        render(searchInput.value.trim());
      }
    });

    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && searchInput.value.trim()) {
        render(searchInput.value.trim());
      }
    });

    // Initial render
    render('latest music videos');
  </script>
</body>
</html>

